[{"id":"f37d137d.f7c26","type":"tab","label":"Rasa Chatbot Starter","disabled":false,"info":""},{"id":"305c7c40.4c680c","type":"tab","label":"Part 2 Solution","disabled":true,"info":""},{"id":"bcdf73f2.b866e","type":"tab","label":"Fallback Solution","disabled":true,"info":""},{"id":"e21dc64e.4f013","type":"slackbot-controller","z":"","name":"","bot_token":"xoxb-643391457621-637076011137-CCUNbgG48RIMk70FZaJeyVM9"},{"id":"65c27b22.b5622c","type":"slackbot-controller","z":"","name":"","bot_token":""},{"id":"95ff7334.f46ff8","type":"slackbot-controller","z":"","name":"","bot_token":"xoxb-643391457621-637076011137-CCUNbgG48RIMk70FZaJeyVM9"},{"id":"24672a70.768db6","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"683c2cea.5d9b94","type":"slackbot-controller","z":"","name":"htwroom","bot_token":"xoxb-643391457621-742690672032-MJkACg55SOdi9BkSo9LGTRmI"},{"id":"c15ffd7f.a061","type":"http in","z":"305c7c40.4c680c","name":"HTTP Request","url":"/chat","method":"post","upload":false,"swaggerDoc":"","x":120,"y":60,"wires":[["d950ce52.9d7e5"]]},{"id":"d950ce52.9d7e5","type":"http request","z":"305c7c40.4c680c","name":"Rasa Request","method":"POST","ret":"obj","url":"http://rasa:5000/parse","tls":"","x":320,"y":60,"wires":[["afb49010.10c138"]]},{"id":"72ff1329.ebb564","type":"http response","z":"305c7c40.4c680c","name":"HTTP Response","statusCode":"","headers":{},"x":700,"y":200,"wires":[]},{"id":"afb49010.10c138","type":"switch","z":"305c7c40.4c680c","name":"Intent Switch","property":"payload.intent.name","propertyType":"msg","rules":[{"t":"eq","v":"chuckNorris","vt":"str"},{"t":"eq","v":"advice","vt":"str"},{"t":"eq","v":"greet","vt":"str"},{"t":"eq","v":"goodbye","vt":"str"}],"checkall":"false","outputs":4,"x":510,"y":60,"wires":[["8ae7582d.ff64e8"],["ab1a7938.441d98"],["5526b47.52672cc"],["babc8599.ac2fd"]]},{"id":"1af81bb9.bdb274","type":"http in","z":"f37d137d.f7c26","name":"HTTP Request","url":"/chat","method":"post","upload":false,"swaggerDoc":"","x":100,"y":40,"wires":[["3e65cac8.85975e"]]},{"id":"3e65cac8.85975e","type":"http request","z":"f37d137d.f7c26","name":"Rasa Request","method":"POST","ret":"obj","url":"http://rasa:5000/parse","tls":"","x":300,"y":40,"wires":[["b27c373b.a97188"]]},{"id":"8581e36a.36b23","type":"http response","z":"f37d137d.f7c26","name":"HTTP Response","statusCode":"","headers":{},"x":830,"y":421,"wires":[]},{"id":"b27c373b.a97188","type":"switch","z":"f37d137d.f7c26","name":"Intent Switch","property":"payload.intent.name","propertyType":"msg","rules":[{"t":"eq","v":"chuckNorris","vt":"str"},{"t":"eq","v":"advice","vt":"str"},{"t":"eq","v":"greet","vt":"str"},{"t":"eq","v":"goodbye","vt":"str"},{"t":"eq","v":"room_search","vt":"str"}],"checkall":"false","outputs":5,"x":490,"y":40,"wires":[["2e3b6022.5480c"],["888efca5.eaffd8"],["43bed1f4.651c7"],["23f7d90e.c10bd6"],["f1366d9a.7ea3"]]},{"id":"8ae7582d.ff64e8","type":"link out","z":"305c7c40.4c680c","name":"chuckNorris Switch","links":["d80552f.9a4aeb"],"x":635,"y":40,"wires":[]},{"id":"ab1a7938.441d98","type":"link out","z":"305c7c40.4c680c","name":"advice Switch","links":["d5a64a51.532398"],"x":675,"y":60,"wires":[]},{"id":"5526b47.52672cc","type":"link out","z":"305c7c40.4c680c","name":"greet Switch","links":["20ffcf1b.f3268"],"x":715,"y":80,"wires":[]},{"id":"babc8599.ac2fd","type":"link out","z":"305c7c40.4c680c","name":"goodbye Switch","links":["c26fb886.452fa"],"x":755,"y":100,"wires":[]},{"id":"d80552f.9a4aeb","type":"link in","z":"305c7c40.4c680c","name":"","links":["8ae7582d.ff64e8"],"x":55,"y":200,"wires":[["c79d0424.205c"]]},{"id":"1ad1c3f9.c0dc1c","type":"comment","z":"305c7c40.4c680c","name":"Chuck Norris Intent Fulfillment","info":"","x":160,"y":160,"wires":[]},{"id":"c79d0424.205c","type":"function","z":"305c7c40.4c680c","name":"","func":"msg.url = 'https://api.chucknorris.io/jokes/random'\n\nif (msg.payload.entities.length > 0) {\n    var query = msg.payload.entities[0].value\n    \n    msg.url = 'https://api.chucknorris.io/jokes/search?query=' + query\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":200,"wires":[["2473627a.c633b6"]]},{"id":"2473627a.c633b6","type":"http request","z":"305c7c40.4c680c","name":"","method":"GET","ret":"obj","url":"","tls":"","x":310,"y":200,"wires":[["dd78dba4.00aac"]]},{"id":"dd78dba4.00aac","type":"function","z":"305c7c40.4c680c","name":"","func":"if (msg.payload.total) {\n    var randomInt = Math.floor(Math.random() * msg.payload.total)\n    \n    msg.payload = msg.payload.result[randomInt].value\n} else {\n    msg.payload = msg.payload.value\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":200,"wires":[["72ff1329.ebb564"]]},{"id":"d5a64a51.532398","type":"link in","z":"305c7c40.4c680c","name":"","links":["ab1a7938.441d98"],"x":55,"y":300,"wires":[["28fcf0a0.3a1d98"]]},{"id":"4d44b8b6.f76618","type":"comment","z":"305c7c40.4c680c","name":"Advice Intent Fulfillment","info":"","x":140,"y":260,"wires":[]},{"id":"28fcf0a0.3a1d98","type":"function","z":"305c7c40.4c680c","name":"","func":"msg.url = 'http://api.adviceslip.com/advice'\n\nif (msg.payload.entities.length > 0) {\n    var query = msg.payload.entities[0].value\n    \n    msg.url = 'http://api.adviceslip.com/advice/search/' + query\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":300,"wires":[["f9d5142a.a1c868"]]},{"id":"f9d5142a.a1c868","type":"http request","z":"305c7c40.4c680c","name":"","method":"GET","ret":"obj","url":"","tls":"","x":310,"y":300,"wires":[["8224d472.9154e"]]},{"id":"8224d472.9154e","type":"function","z":"305c7c40.4c680c","name":"","func":"if (msg.payload.total_results) {\n    var randomInt = Math.floor(Math.random() * msg.payload.total_results)\n    \n    msg.payload = msg.payload.slips[randomInt].advice\n} else {\n    msg.payload = msg.payload.slip.advice\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":300,"wires":[["72ff1329.ebb564"]]},{"id":"20ffcf1b.f3268","type":"link in","z":"305c7c40.4c680c","name":"","links":["5526b47.52672cc"],"x":55,"y":400,"wires":[["2a038a20.2e5cbe"]]},{"id":"8732122c.3e0578","type":"comment","z":"305c7c40.4c680c","name":"Greet Intent Fulfillment","info":"","x":140,"y":360,"wires":[]},{"id":"2a038a20.2e5cbe","type":"function","z":"305c7c40.4c680c","name":"","func":"var intentResponse = [\n    \"Hello\",\n    \"Hey\",\n    \"Greetings earthling!\",\n    \"Hola\"\n]\n\nvar randomInt = Math.floor(Math.random() * intentResponse.length)\n    \nmsg.payload = intentResponse[randomInt]\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":400,"wires":[["72ff1329.ebb564"]]},{"id":"c26fb886.452fa","type":"link in","z":"305c7c40.4c680c","name":"","links":["babc8599.ac2fd"],"x":55,"y":500,"wires":[["e957c521.83fb38"]]},{"id":"ee6b1950.c2f8d8","type":"comment","z":"305c7c40.4c680c","name":"Goodbye Intent Fulfillment","info":"","x":150,"y":460,"wires":[]},{"id":"e957c521.83fb38","type":"function","z":"305c7c40.4c680c","name":"","func":"var intentResponse = [\n    \"C-Ya\",\n    \"Goodbye\",\n    \"Ciao\"\n]\n\nvar randomInt = Math.floor(Math.random() * intentResponse.length)\n    \nmsg.payload = intentResponse[randomInt]\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":500,"wires":[["72ff1329.ebb564"]]},{"id":"2a74fdb6.c24e22","type":"http in","z":"bcdf73f2.b866e","name":"HTTP Request","url":"/chat","method":"post","upload":false,"swaggerDoc":"","x":120,"y":60,"wires":[["8964aeb1.84579"]]},{"id":"8964aeb1.84579","type":"http request","z":"bcdf73f2.b866e","name":"Rasa Request","method":"POST","ret":"obj","url":"http://rasa:5000/parse","tls":"","x":300,"y":60,"wires":[["81696e01.cf715"]]},{"id":"446bd877.5435b8","type":"http response","z":"bcdf73f2.b866e","name":"HTTP Response","statusCode":"","headers":{},"x":960,"y":520,"wires":[]},{"id":"a1aaab52.92e238","type":"switch","z":"bcdf73f2.b866e","name":"Intent Switch","property":"payload.intent.name","propertyType":"msg","rules":[{"t":"eq","v":"chuckNorris","vt":"str"},{"t":"eq","v":"advice","vt":"str"},{"t":"eq","v":"greet","vt":"str"},{"t":"eq","v":"goodbye","vt":"str"},{"t":"eq","v":"marriageProposal","vt":"str"},{"t":"eq","v":"knockKnock","vt":"str"},{"t":"eq","v":"fallback","vt":"str"}],"checkall":"false","outputs":7,"x":710,"y":60,"wires":[["3fdf4197.a4b88e"],["74a6931e.99d0c4"],["caebfeed.7bee68"],["c727ced7.0813a"],["dcafa9ce.b0a698"],["f11d86f0.a07cf8"],["94a8d0ca.0b5f68"]]},{"id":"53482997.1f7dd","type":"comment","z":"bcdf73f2.b866e","name":"Chuck Norris Intent Fulfillment","info":"","x":160,"y":160,"wires":[]},{"id":"8c0b0b56.6bec18","type":"function","z":"bcdf73f2.b866e","name":"","func":"msg.url = 'https://api.chucknorris.io/jokes/random'\n\nif (msg.payload.entities.length > 0) {\n    var query = msg.payload.entities[0].value\n    \n    msg.url = 'https://api.chucknorris.io/jokes/search?query=' + query\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":200,"wires":[["ecf99717.f8464"]]},{"id":"ecf99717.f8464","type":"http request","z":"bcdf73f2.b866e","name":"","method":"GET","ret":"obj","url":"","tls":"","x":310,"y":200,"wires":[["5279e276.9e06c4"]]},{"id":"5279e276.9e06c4","type":"function","z":"bcdf73f2.b866e","name":"","func":"if (msg.payload.total) {\n    var randomInt = Math.floor(Math.random() * msg.payload.total)\n    \n    msg.payload = msg.payload.result[randomInt].value\n} else {\n    msg.payload = msg.payload.value\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":200,"wires":[["446bd877.5435b8"]]},{"id":"7fc7133e.47d66c","type":"comment","z":"bcdf73f2.b866e","name":"Advice Intent Fulfillment","info":"","x":140,"y":260,"wires":[]},{"id":"f77d163.72fd1e8","type":"function","z":"bcdf73f2.b866e","name":"","func":"msg.url = 'http://api.adviceslip.com/advice'\n\nif (msg.payload.entities.length > 0) {\n    var query = msg.payload.entities[0].value\n    \n    msg.url = 'http://api.adviceslip.com/advice/search/' + query\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":300,"wires":[["2efe68e7.48af38"]]},{"id":"2efe68e7.48af38","type":"http request","z":"bcdf73f2.b866e","name":"","method":"GET","ret":"obj","url":"","tls":"","x":310,"y":300,"wires":[["ed474074.fef6a"]]},{"id":"ed474074.fef6a","type":"function","z":"bcdf73f2.b866e","name":"","func":"if (msg.payload.total_results) {\n    var randomInt = Math.floor(Math.random() * msg.payload.total_results)\n    \n    msg.payload = msg.payload.slips[randomInt].advice\n} else {\n    msg.payload = msg.payload.slip.advice\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":300,"wires":[["446bd877.5435b8"]]},{"id":"ebd5ca5d.4abf1","type":"comment","z":"bcdf73f2.b866e","name":"Greet Intent Fulfillment","info":"","x":140,"y":360,"wires":[]},{"id":"bcdc282f.26cf8","type":"function","z":"bcdf73f2.b866e","name":"","func":"var intentResponse = [\n    \"Hello\",\n    \"Hey\",\n    \"Greetings earthling!\",\n    \"Hola\"\n]\n\nvar randomInt = Math.floor(Math.random() * intentResponse.length)\n    \nmsg.payload = intentResponse[randomInt]\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":400,"wires":[["446bd877.5435b8"]]},{"id":"4e3cb697.e83c08","type":"comment","z":"bcdf73f2.b866e","name":"Goodbye Intent Fulfillment","info":"","x":150,"y":460,"wires":[]},{"id":"abc4235f.3a944","type":"function","z":"bcdf73f2.b866e","name":"","func":"var intentResponse = [\n    \"C-Ya\",\n    \"Goodbye\",\n    \"Ciao\"\n]\n\nvar randomInt = Math.floor(Math.random() * intentResponse.length)\n    \nmsg.payload = intentResponse[randomInt]\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":500,"wires":[["446bd877.5435b8"]]},{"id":"91d105fc.6dda9","type":"comment","z":"bcdf73f2.b866e","name":"Marriage Proposal Intent Fulfillment","info":"","x":180,"y":560,"wires":[]},{"id":"e6f15ee4.e4364","type":"function","z":"bcdf73f2.b866e","name":"","func":"var intentResponse = [\n    \"Sorry I'm taken\",\n    \"That would be nice, but what will your parents think!\",\n    \"I don't think so wierdo.\"\n]\n\nvar randomInt = Math.floor(Math.random() * intentResponse.length)\n    \nmsg.payload = intentResponse[randomInt]\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":600,"wires":[["446bd877.5435b8"]]},{"id":"227a241f.ccd4f4","type":"comment","z":"bcdf73f2.b866e","name":"Knock Knock Intent Fulfillment","info":"","x":170,"y":660,"wires":[]},{"id":"e611fab0.2cbbf","type":"function","z":"bcdf73f2.b866e","name":"","func":"var intentResponse = [\n    \"Sorry I don't know any knock knock jokes. I'm all about Chuck Norris and giving advice, but not giving advice to Chuck Norris.\",\n    \"Move along, no knock knock jokes here.\"\n]\n\nvar randomInt = Math.floor(Math.random() * intentResponse.length)\n    \nmsg.payload = intentResponse[randomInt]\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":700,"wires":[["446bd877.5435b8"]]},{"id":"4aaba97d.72a238","type":"comment","z":"bcdf73f2.b866e","name":"Fallback Intent Fulfillment","info":"","x":150,"y":760,"wires":[]},{"id":"4c72555f.a07a4c","type":"function","z":"bcdf73f2.b866e","name":"","func":"var intentResponse = [\n    \"I'm sorry I didn't understand that.\",\n    \"Can you try to re-phrase that I don't know what you are after.\",\n    \"You may be asking for something I can't do, all I know about are chuck norris jokes and giving advice.\"\n]\n\nvar randomInt = Math.floor(Math.random() * intentResponse.length)\n    \nmsg.payload = intentResponse[randomInt]\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":800,"wires":[["446bd877.5435b8"]]},{"id":"81696e01.cf715","type":"switch","z":"bcdf73f2.b866e","name":"Confidence Switch","property":"payload.intent.name","propertyType":"msg","rules":[{"t":"gt","v":".5","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":490,"y":60,"wires":[["a1aaab52.92e238"],["82b46fea.8dac58"]]},{"id":"80ba464.2155838","type":"link in","z":"bcdf73f2.b866e","name":"","links":["94a8d0ca.0b5f68"],"x":55,"y":800,"wires":[["4c72555f.a07a4c"]]},{"id":"80fecb5a.4e0f78","type":"link in","z":"bcdf73f2.b866e","name":"","links":["f11d86f0.a07cf8"],"x":55,"y":700,"wires":[["e611fab0.2cbbf"]]},{"id":"6501f98f.8a2a08","type":"link in","z":"bcdf73f2.b866e","name":"","links":["dcafa9ce.b0a698"],"x":55,"y":600,"wires":[["e6f15ee4.e4364"]]},{"id":"f2a842a5.c28e5","type":"link in","z":"bcdf73f2.b866e","name":"","links":["c727ced7.0813a"],"x":55,"y":500,"wires":[["abc4235f.3a944"]]},{"id":"25317f0b.da03c","type":"link in","z":"bcdf73f2.b866e","name":"","links":["caebfeed.7bee68"],"x":55,"y":400,"wires":[["bcdc282f.26cf8"]]},{"id":"f06ff4f4.d7dd","type":"link in","z":"bcdf73f2.b866e","name":"","links":["74a6931e.99d0c4"],"x":55,"y":300,"wires":[["f77d163.72fd1e8"]]},{"id":"853a4884.020eb8","type":"link in","z":"bcdf73f2.b866e","name":"","links":["3fdf4197.a4b88e"],"x":55,"y":200,"wires":[["8c0b0b56.6bec18"]]},{"id":"3fdf4197.a4b88e","type":"link out","z":"bcdf73f2.b866e","name":"chuckNorris Switch","links":["853a4884.020eb8"],"x":795,"y":20,"wires":[]},{"id":"74a6931e.99d0c4","type":"link out","z":"bcdf73f2.b866e","name":"advice Switch","links":["f06ff4f4.d7dd"],"x":835,"y":40,"wires":[]},{"id":"caebfeed.7bee68","type":"link out","z":"bcdf73f2.b866e","name":"greet Switch","links":["25317f0b.da03c"],"x":875,"y":60,"wires":[]},{"id":"c727ced7.0813a","type":"link out","z":"bcdf73f2.b866e","name":"goodbye Switch","links":["f2a842a5.c28e5"],"x":915,"y":80,"wires":[]},{"id":"dcafa9ce.b0a698","type":"link out","z":"bcdf73f2.b866e","name":"Marriage Proposal Switch","links":["6501f98f.8a2a08"],"x":955,"y":100,"wires":[]},{"id":"f11d86f0.a07cf8","type":"link out","z":"bcdf73f2.b866e","name":"Knock Knock Switch","links":["80fecb5a.4e0f78"],"x":995,"y":120,"wires":[]},{"id":"94a8d0ca.0b5f68","type":"link out","z":"bcdf73f2.b866e","name":"Fallback Switch","links":["80ba464.2155838"],"x":1035,"y":140,"wires":[]},{"id":"82b46fea.8dac58","type":"function","z":"bcdf73f2.b866e","name":"","func":"var intentResponse = [\n    \"I'm not certain what you mean, can you try re-phrasing that.\",\n    \"I'm just a young bot, all I know about are chuck norris jokes and giving advice.\"\n]\n\nvar randomInt = Math.floor(Math.random() * intentResponse.length)\n    \nmsg.payload = intentResponse[randomInt]\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":160,"wires":[["446bd877.5435b8"]]},{"id":"2e3b6022.5480c","type":"link out","z":"f37d137d.f7c26","name":"chuckNorris","links":["5390ceb1.588c"],"x":655,"y":20,"wires":[]},{"id":"888efca5.eaffd8","type":"link out","z":"f37d137d.f7c26","name":"advice","links":["fdb2eab6.23bd08"],"x":695,"y":40,"wires":[]},{"id":"43bed1f4.651c7","type":"link out","z":"f37d137d.f7c26","name":"greet","links":["f4336232.79ddf"],"x":735,"y":60,"wires":[]},{"id":"23f7d90e.c10bd6","type":"link out","z":"f37d137d.f7c26","name":"goodbye","links":["2ccf591b.13838e"],"x":753.5,"y":94,"wires":[]},{"id":"82f0f1f2.a6272","type":"comment","z":"f37d137d.f7c26","name":"Chuck Norris Intent Fulfillment","info":"","x":380,"y":160,"wires":[]},{"id":"5390ceb1.588c","type":"link in","z":"f37d137d.f7c26","name":"","links":["2e3b6022.5480c"],"x":195,"y":260,"wires":[["fc01e98.5f60418"]]},{"id":"fc01e98.5f60418","type":"function","z":"f37d137d.f7c26","name":"","func":"msg.url = 'https://api.chucknorris.io/jokes/random'\nif (msg.payload.entities.length > 0) {\n    var query = msg.payload.entities[0].value\n    \n    msg.url = 'https://api.chucknorris.io/jokes/search?query=' + query\n}\nreturn msg;","outputs":1,"noerr":0,"x":299.5,"y":260,"wires":[["5da0c7ee.fffcc"]]},{"id":"5da0c7ee.fffcc","type":"http request","z":"f37d137d.f7c26","name":"","method":"GET","ret":"obj","url":"","tls":"","x":448.5,"y":259,"wires":[["4521f27e.83fa0c"]]},{"id":"4521f27e.83fa0c","type":"function","z":"f37d137d.f7c26","name":"","func":"if (msg.payload.total) {\n    var randomInt = Math.floor(Math.random() * msg.payload.total)\n    \n    msg.payload = msg.payload.result[randomInt].value\n} else {\n    msg.payload = msg.payload.value\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":630,"y":260,"wires":[["8581e36a.36b23"]]},{"id":"fdb2eab6.23bd08","type":"link in","z":"f37d137d.f7c26","name":"","links":["888efca5.eaffd8"],"x":175,"y":360,"wires":[["9965a5db.3fda9"]]},{"id":"9965a5db.3fda9","type":"function","z":"f37d137d.f7c26","name":"","func":"msg.url = 'http://api.adviceslip.com/advice'\nif (msg.payload.entities.length > 0) {\n    var query = msg.payload.entities[0].value\n    \n    msg.url = 'http://api.adviceslip.com/advice/search/' + query\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":291.5,"y":349,"wires":[["13ea5e11.37164a"]]},{"id":"13ea5e11.37164a","type":"http request","z":"f37d137d.f7c26","name":"","method":"GET","ret":"obj","url":"","tls":"","x":438.5,"y":349,"wires":[["7a3d9ea0.5ff8c8"]]},{"id":"7a3d9ea0.5ff8c8","type":"function","z":"f37d137d.f7c26","name":"","func":"if (msg.payload.total_results) {\n    var randomInt = Math.floor(Math.random() * msg.payload.total_results)\n    \n    msg.payload = msg.payload.slips[randomInt].advice\n} else {\n    msg.payload = msg.payload.slip.advice\n}\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":340,"wires":[["8581e36a.36b23"]]},{"id":"f4336232.79ddf","type":"link in","z":"f37d137d.f7c26","name":"","links":["43bed1f4.651c7"],"x":174.5,"y":402,"wires":[["52a158c7.b412b8"]]},{"id":"52a158c7.b412b8","type":"function","z":"f37d137d.f7c26","name":"","func":"var intentResponse = [\n    \"C-Ya\",\n    \"Goodbye\",\n    \"Ciao\"\n]\nvar randomInt = Math.floor(Math.random() * intentResponse.length)\n    \nmsg.payload = intentResponse[randomInt]\nreturn msg;","outputs":1,"noerr":0,"x":324.5,"y":403,"wires":[["8581e36a.36b23"]]},{"id":"2ccf591b.13838e","type":"link in","z":"f37d137d.f7c26","name":"","links":["23f7d90e.c10bd6"],"x":174.5,"y":433,"wires":[["8f9d277b.182a98"]]},{"id":"8f9d277b.182a98","type":"function","z":"f37d137d.f7c26","name":"","func":"var intentResponse = [\n    \"Hello\",\n    \"Hey\",\n    \"Greetings earthling!\",\n    \"Hola\"\n]\nvar randomInt = Math.floor(Math.random() * intentResponse.length)\n    \nmsg.payload = intentResponse[randomInt]\nreturn msg;","outputs":1,"noerr":0,"x":309.5,"y":439,"wires":[["8581e36a.36b23"]]},{"id":"2414f232.520966","type":"slackbot-listen","z":"f37d137d.f7c26","slackbot":"683c2cea.5d9b94","name":"","x":96.5,"y":767,"wires":[["290a5bd4.7db2d4"]]},{"id":"eea7c8ad.25709","type":"slackbot-reply","z":"f37d137d.f7c26","slackbot":"683c2cea.5d9b94","name":"","x":798.5,"y":764,"wires":[]},{"id":"9f4785ad.044d48","type":"function","z":"f37d137d.f7c26","name":"Call Rasa ","func":"var query = msg.payload\nvar model = 'rasaTutorialBot'\nmsg.url = 'http://node-red:1880/chat'\nmsg.payload = {\n    \"q\": query,\n    \"model\": model\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":439.5,"y":765,"wires":[["20f1a.7ae210e68"]]},{"id":"20f1a.7ae210e68","type":"http request","z":"f37d137d.f7c26","name":"","method":"POST","ret":"txt","url":"","tls":"","x":607.5,"y":766,"wires":[["eea7c8ad.25709"]]},{"id":"b9ea4ef3.ed70d","type":"file in","z":"f37d137d.f7c26","name":"Read from Gebäude JSON file","filename":"/tmp/data.json","format":"utf8","chunk":false,"sendError":false,"x":474,"y":564,"wires":[["4c74edd6.a0ba34"]]},{"id":"8f78cab9.a854d8","type":"inject","z":"f37d137d.f7c26","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":118.5,"y":898,"wires":[[]]},{"id":"4c74edd6.a0ba34","type":"function","z":"f37d137d.f7c26","name":"Prepare Final Answer","func":"node.warn(msg.payload.entities[1].value)\n//global variables\nvar globalVariable=global.get('globalVariable');\n//flow variables\nvar question=flow.get('question');\nvar result=flow.get('result');\n//node variables\ncontext.gebaeude = [];\nvar campus;\nvar length=0;\n\n\n//load file\nmsg.payload=JSON.parse(msg.payload);\n\n// prepare campus if exists in question\nif (question.includes(\"Wilhelminenhof\")) campus = \"WH\";\nelse if (question.includes(\"Treskowallee\")) campus = \"TA\";\nelse campus = \"Kein Campus gefunden\";\n\n//check if date entity is set\n//for(i = 0; i < result.entities.length; i++){\n//    if((result.entities[i].entity).includes(\"date\")){\n      //msg.payload=\"Date vorhanden\";\n      //return msg;\n//      }\n//}\n\n//Get campus \nfor(var k in msg.payload){\n    for(var x in msg.payload[k].VCALENDAR[0].VEVENT){\n      if(msg.payload[k].VCALENDAR[0].VEVENT.hasOwnProperty(x)){\n         length++;  \n      }  \n    } \n    for(i = 0; i < length; i++){\n       if((msg.payload[k].VCALENDAR[0].VEVENT[i].LOCATION).includes(campus)){\n              context.gebaeude.push(decodeURIComponent(escape(msg.payload[k].VCALENDAR[0].VEVENT[0].LOCATION)));\n//            context.gebaeude.push(\"Startzeit: \"+msg.payload[k].VCALENDAR[0].VEVENT[0][\"DTSTART;TZID=Europe/Berlin\"]);\n//            context.gebaeude.push(\"Endzeit: \"+msg.payload[k].VCALENDAR[0].VEVENT[0][\"DTEND;TZID=Europe/Berlin\"]);\n       }\n    }\n    length=0;\n}  \n\n\n//node.warn(msg.payload[11].VCALENDAR[0].VEVENT[0].LOCATION);\n//var x=msg.payload.length;\n//msg.payload=decodeURIComponent(escape(msg.payload[\"0\"].VCALENDAR[0].VEVENT[0].LOCATION));\n//node.warn(context.gebaeude);\nmsg.payload=context.gebaeude;\nreturn msg;\n","outputs":1,"noerr":0,"x":733.5,"y":565,"wires":[[]]},{"id":"f1366d9a.7ea3","type":"link out","z":"f37d137d.f7c26","name":"room_search","links":["dfc2aacc.236288"],"x":662.5,"y":124,"wires":[]},{"id":"592171bd.e6282","type":"link in","z":"f37d137d.f7c26","name":"","links":[],"x":50.5,"y":566,"wires":[["db56d1dc.a534f"]]},{"id":"1c8cf91a.bddcd7","type":"function","z":"f37d137d.f7c26","name":"","func":"node.warn(msg);\nif (msg.payload.total_results) {\n    var randomInt = Math.floor(Math.random() * msg.payload.total_results)\n    \n    //msg.payload = msg.payload.slips[randomInt].value\n} else {\n    //msg.payload = msg.payload.slip.value\n}\nreturn msg;","outputs":1,"noerr":0,"x":479.5,"y":891,"wires":[[]]},{"id":"db56d1dc.a534f","type":"function","z":"f37d137d.f7c26","name":"Save Rasa Result","func":"var result=flow.get('result');\nflow.set('result',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":188.5,"y":565,"wires":[["b9ea4ef3.ed70d"]]},{"id":"290a5bd4.7db2d4","type":"function","z":"f37d137d.f7c26","name":"Save Question","func":"var question=flow.get('question');\nflow.set('question',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":266.5,"y":765,"wires":[["9f4785ad.044d48"]]},{"id":"238cd90e.6da326","type":"debug","z":"f37d137d.f7c26","name":"","active":true,"console":"false","complete":"payload","x":810.5,"y":643,"wires":[]},{"id":"dfc2aacc.236288","type":"link in","z":"f37d137d.f7c26","name":"","links":["f1366d9a.7ea3"],"x":155,"y":500,"wires":[["fe54a976.3bbea8"]]},{"id":"fe54a976.3bbea8","type":"function","z":"f37d137d.f7c26","name":"","func":"var question=flow.get('question');\nvar url=\"http://172.16.233.6:1888\";\nmsg.url = url+'/todo/api/v1.0'\n//0=date, 1=campus, 2=day\ncontext.entities = [false,false,false,false,false,false];\ncontext.entitiesValue = [];\n\n//check entities are set\nfor(i = 0; i < msg.payload.entities.length; i++){\n    //date\n    if((msg.payload.entities[i].entity).includes(\"date\")){\n      context.entities[0]=true;\n      context.entitiesValue[0]=msg.payload.entities[i].value;\n      }\n    //campus  \n    if((msg.payload.entities[i].entity).includes(\"campus\")){\n      context.entities[1]=true;\n      context.entitiesValue[1]=msg.payload.entities[i].value;\n      }\n     // day  \n    if((msg.payload.entities[i].entity).includes(\"day\")){\n      context.entities[2]=true;\n      context.entitiesValue[2]=msg.payload.entities[i].value;\n      }\n       // room_number\n       if((msg.payload.entities[i].entity).includes(\"room_number\")){\n      context.entities[3]=true;\n      context.entitiesValue[3]=msg.payload.entities[i].value;\n      }\n     // room_location\n     if((msg.payload.entities[i].entity).includes(\"room_location\")){\n      context.entities[4]=true;\n      context.entitiesValue[4]=msg.payload.entities[i].value;\n      }\n     \n      // time\n       if((msg.payload.entities[i].entity).includes(\"time\")){\n      context.entities[5]=true;\n      context.entitiesValue[5]=msg.payload.entities[i].value;\n      }\n}\n\nnode.warn(context.entitiesValue);\nnode.warn(context.entities);\n//call right api\n\nif(context.entities[0] === true)\n{\n     msg.url+=\"/date/\"+context.entitiesValue[0];\n     if(context.entities[5] === true)\n    {\n        msg.url+=\"T\"+context.entitiesValue[5];   \n    }\n     \n}\nif(context.entities[1] === true)\n{\n     msg.url+=\"/campus/\"+context.entitiesValue[1];\n        \n}\nif(context.entities[2] === true)\n{\n        msg.url+=\"/day/\"+context.entitiesValue[2];\n     \n}\nif(context.entities[3] === true)\n{\n        msg.url+=\"/room_number/\"+context.entitiesValue[3];\n     \n}\nif(context.entities[4] === true)\n{\n        msg.url+=\"/room_location/\"+context.entitiesValue[4];\n}\n\n    \n\n\n//if (msg.payload.entities.length > 0) {\n//    var query = msg.payload.entities\n    //node.warn(query);\n//    if(msg.payload.entities[0].entity== \"date\")\n//      msg.url = '192.168.188.21:1888/todo/api/v1.0/date/' + query[0].value\n    //break;\n//    if(msg.payload.entities[1].entity== \"campus\")\n        \n//       msg.url = '192.168.188.21:1888/todo/api/v1.0/date/' + query[0].value+'/campus/' + query[1].value\n   // 10.188.255.185:1888\n    \n//}\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":500,"wires":[["508e5121.b71e4"]]},{"id":"508e5121.b71e4","type":"http request","z":"f37d137d.f7c26","name":"","method":"GET","ret":"obj","url":"","tls":"","x":470,"y":500,"wires":[["135eb17b.f4ddef"]]},{"id":"135eb17b.f4ddef","type":"function","z":"f37d137d.f7c26","name":"","func":"node.warn(msg);\nif(msg.payload.message.question !== undefined){\n    msg.payload = msg.payload.message.question;\n    return msg;\n}\nif(msg.payload.message.length > 1){\n    var randomInt = Math.floor(Math.random() * msg.payload.total_results);\n    msg.payload = msg.payload.message[randomInt].LOCATION;\n    return msg;\n}\nelse {\n    msg.payload = msg.payload.message.LOCATION;\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":500,"wires":[["238cd90e.6da326"]]}]